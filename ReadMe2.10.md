# MyAIチャット履歴 Ver2.10

このアプリケーションは、Google Gemini AIとの自由な対話を記録し、要約を生成してローカルファイルとして保存・管理できるツールです。AIの応答設定（性格、TTSなど）やチャット履歴を柔軟に管理し、PDFとしてエクスポートする機能も備わっています。

## 目次

1.  [主な機能](#1-主な機能)
2.  [はじめに (APIキー設定)](#2-はじめに-apiキー設定)
3.  [使用方法](#3-使用方法)
    *   [AIとのチャット](#aiとのチャット)
    *   [チャットの保存と概要生成](#チャットの保存と概要生成)
    *   [履歴の管理](#履歴の管理)
    *   [各種設定](#各種設定)
    *   [PDFプレビューとダウンロード](#pdfプレビューとダウンロード)
4.  [重要な注意事項](#4-重要な注意事項)
5.  [バージョン情報](#5-バージョン情報)

## 1. 主な機能

*   **AIとのチャット:**
    *   テキスト入力、画像添付（ペーストまたはファイル選択）、音声入力（マイク）によるAIとの対話。
    *   過去のメッセージの選択、削除、編集、音声再生機能。
*   **チャット履歴管理:**
    *   現在のチャット内容をAIが自動でタイトルと概要を生成し、Markdown形式でファイルダウンロード。
    *   保存された全チャット履歴をJSONファイルとして一括エクスポート/インポート。
    *   履歴リストからのチャット読み込み、選択削除、並べ替え（日付/タイトル）、検索機能。
*   **設定カスタマイズ:**
    *   AIの性格（システムプロンプト）、チャット概要生成プロンプトの設定。
    *   ユーザー名・AI名の設定。
    *   AI応答時のサウンド通知、音声読み上げ（Text-to-Speech: TTS）のON/OFF、音声の種類、速度、ピッチ、音量調整。
    *   各種設定をCSVファイルとしてエクスポート/インポート。
*   **APIキー管理:**
    *   Google Gemini APIキーの設定、テスト、クリア。
*   **PDFエクスポート:**
    *   現在のチャット履歴をPDF形式でプレビュー表示し、ダウンロード。
*   **ヘルプ機能:**
    *   アプリケーションの操作方法を説明する取扱説明書を表示。

## 2. はじめに (APIキー設定)

このアプリケーションを利用するには、Google Gemini APIキーが必要です。

1.  アプリケーションを起動します。
2.  ヘッダーの右側にある「**API設定**」ボタンをクリックします。
3.  モーダルウィンドウが表示されるので、[Google Cloud Console](https://console.cloud.google.com/)などで取得したGemini APIキーを入力してください。
4.  「**APIキーをテスト**」ボタンでキーが有効か確認できます。
5.  「**設定**」ボタンをクリックしてモーダルを閉じ、APIキーをセッション中に利用可能な状態にします。

**【重要】APIキーはブラウザに自動で保存されず、セッション中のみ有効です。セッションを終了（ブラウザを閉じるなど）すると再入力が必要になります。**

## 3. 使用方法

### AIとのチャット

*   **メッセージの送信:** `text-input` エリアにメッセージを入力し、`Enter` キーを押すか、飛行機アイコン `✈️` の「**送信**」ボタンをクリックします。改行は `Shift + Enter` で行えます。
*   **画像の添付:** クリップアイコン `📎` のボタンをクリックして画像ファイルを選択するか、入力エリアに直接画像をペーストすることで、画像とメッセージを同時に送信できます。
*   **音声入力:** マイクアイコン `🎤` のボタンをクリックすると、音声入力が開始されます。もう一度クリックすると停止し、認識されたテキストが入力エリアに追加されます。
*   **メッセージ操作:**
    *   チャット内の任意のメッセージをクリックすると、そのメッセージが選択状態になります。
    *   選択されたメッセージがある状態で、ヘッダーの「**選択を削除**」ボタンで削除、「**選択を編集**」ボタンで内容を修正、「**選択を再生**」ボタンで音声読み上げが行えます。
    *   音声読み上げ中に「**音声停止**」ボタンで再生を中断できます。
*   **新しいチャット:** ヘッダーの「**新しいチャット**」ボタンをクリックすると、現在の会話内容を破棄して新しいチャットを開始します。（保存していない内容は失われます。）

### チャットの保存と概要生成

*   **チャット保存:** ヘッダーの「**チャット保存**」ボタンをクリックすると、現在の会話履歴がAIによって分析され、タイトルと概要が生成されます。
    *   生成されたタイトルと概要を含むMarkdown形式のファイルが自動的にダウンロードされます。
    *   同時に、このチャットの概要がアプリケーションの履歴リストに自動的に追加されます。
    *   要約生成AIへの具体的な指示は「各種設定」でカスタマイズ可能です。

### 履歴の管理

*   **履歴一覧:** ヘッダーの「**履歴一覧**」ボタンをクリックすると、保存されたチャット履歴のリストが表示されます。
    *   リストはタイトルや日付で検索でき、「並べ替え」オプションで表示順を変更できます。
    *   リスト内のチェックボックスで複数の履歴を選択し、「**選択を読込**」でチャットボックスに表示、「**選択を削除**」でリストから削除できます。
    *   **【重要】リストへの追加や削除は一時的なもので、永続化するには「各種設定」内の「全履歴をJSONで保存」を行う必要があります。**
*   **全履歴のエクスポート/インポート:**
    *   「各種設定」モーダルの「**全履歴をJSONで保存**」で、現在アプリに読み込まれている全てのチャット履歴をJSONファイルとしてダウンロードできます。
    *   「**全履歴をJSONから読込**」で、以前保存したJSONファイルを読み込み、履歴リストを復元・更新できます。

### 各種設定

ヘッダーの「**各種設定**」ボタンをクリックすると、以下の項目を設定できます。

*   **AIの性格（システムプロンプト）:** AIの応答スタイルや役割を指示するプロンプトを入力します。いくつかの「設定例」ボタンも用意されています。
*   **チャット概要生成プロンプト:** 「チャット保存」時にAIが要約を生成するための指示プロンプトをカスタマイズできます。`{CONVERSATION_HISTORY}` の部分に実際の会話履歴が挿入されます。**もし要約がうまく生成されない場合は、「デフォルトに戻す」ボタンをクリックして初期設定に戻してみてください。**
*   **会話履歴の名前設定:** あなたとAIの表示名を変更できます。
*   **サウンド設定:**
    *   AI応答時のサウンドのON/OFF、サウンドの種類（サイン波、矩形波など）を設定できます。
    *   AI応答の音声読み上げ（TTS）のON/OFF、音声の種類、速度、ピッチ、音量を調整できます。
*   **設定のエクスポート/インポート:**
    *   「**設定をCSVで保存**」で、現在の各種設定（APIキーを除く）をCSVファイルとしてダウンロードできます。
    *   「**設定をCSVから読込**」で、以前保存したCSVファイルから設定を復元できます。

### PDFプレビューとダウンロード

*   **PDFプレビュー:** ヘッダーの「**PDFプレビュー**」ボタンをクリックすると、現在チャットボックスに表示されているチャット履歴のPDFプレビューが表示されます。
    *   PDFプレビュー画面で「**PDFをダウンロード**」ボタンをクリックすると、適切なファイル名でPDFファイルを保存できます。

## 4. 重要な注意事項

*   **APIキーの管理:** Gemini APIキーは**ブラウザには自動で保存されません**。このアプリケーションはセッション中のみAPIキーをメモリに保持します。そのため、ブラウザを閉じるとAPIキーは失われ、次回利用時に再入力が必要です。
*   **データ永続化:** チャット履歴、各種設定は**自動で保存されません**。データの保存・復元には、「各種設定」内の「**全履歴をJSONで保存**」や「**設定をCSVで保存**」などのエクスポート・インポート機能をご利用ください。
*   **Gemini APIの利用料金:** Gemini APIの利用には、Google Cloudの請求設定に準じた費用が発生する場合があります。ご自身のAPI利用量にご注意ください。
*   **チャット概要生成プロンプト:** 要約が正しく生成されない場合、あるいは期待と異なる出力となる場合は、「各種設定」内の「**チャット概要生成プロンプト**」を確認し、必要に応じて「**デフォルトに戻す**」ボタンでリセットしてください。また、AIに送信されるプロンプトの内容は開発者コンソール（F12キーで開く）で確認できます。

## 5. バージョン情報

**Ver2.10**
*   チャット保存時のタイトルと概要生成の更新機能を強化。
*   チャットセッションにユニークID (`chatId`) を導入し、既存チャットの再保存時に元の履歴を更新するように変更。
*   「履歴一覧」での履歴管理（削除、読み込み、エクスポート/インポート）が `chatId` を基準に行われるように改修。
*   「各種設定」モーダルに、チャット概要生成プロンプトをデフォルトに戻す「**デフォルトに戻す**」ボタンを追加。
*   要約生成APIに送信されるプロンプトおよびAPIからの生応答を開発者コンソールにログ出力するデバッグ機能を追加。
*   古い形式の履歴データ（`chatId`がないもの）をインポートした際にも対応できるように改善。

---