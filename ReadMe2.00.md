# ＭｙAIチャット履歴 Ver2.00 (ファイル保存版)

このアプリケーションは、GoogleのGemini APIを利用してAIとチャットし、その会話履歴を効率的に管理・保存・閲覧できるWebツールです。AIの応答は音声で読み上げたり、チャット履歴を要約してMarkdownファイルやPDFファイルとしてエクスポートしたりすることができます。すべてのデータはファイルとしてユーザーのPCに保存されるため、プライバシーを保護しつつ柔軟なデータ管理が可能です。

## 目次

*   [主要機能](#主要機能)
*   [重要事項](#重要事項)
*   [使い方](#使い方)
    *   [1. APIキーの設定（初回必須）](#1-apiキーの設定初回必須)
    *   [2. AIとのチャット](#2-aiとのチャット)
    *   [3. チャットの保存と履歴管理](#3-チャットの保存と履歴管理)
    *   [4. 各種設定](#4-各種設定)
    *   [5. PDFプレビュー](#5-pdfプレビュー)
*   [技術スタック](#技術スタック)
*   [ライセンス](#ライセンス)

## 主要機能

*   **AIチャット**: Gemini APIを利用したAIとのリアルタイムな対話。
*   **画像認識**: 画像を添付してAIに質問することが可能。
*   **音声入力**: マイクボタンからの音声入力に対応。
*   **音声読み上げ (TTS)**: AIの応答を自動で音声読み上げ。音声の種類、速度、ピッチ、音量を調整可能。
*   **チャット履歴の操作**:
    *   メッセージの選択、削除、編集、音声再生。
    *   現在のチャット内容をAIが自動要約し、Markdownファイルとして保存。
    *   保存したチャットのタイトル、概要、会話履歴の一覧表示と読み込み。
    *   履歴リストの検索、並べ替え（日付/タイトル、昇順/降順）。
    *   選択した履歴の一括削除（インメモリリストから）。
*   **全履歴のファイル管理**: すべてのチャット履歴をJSONファイルとしてまとめてエクスポート/インポート。
*   **各種設定のファイル管理**: AIの性格（システムプロンプト）、チャット概要生成プロンプト、ユーザー名/AI名、サウンド設定、TTS設定をCSVファイルとしてエクスポート/インポート。
*   **PDFエクスポート**: 表示中のチャット履歴をPDFファイルとしてプレビュー・ダウンロード。
*   **ヘルプ**: アプリケーションの取扱説明書を表示。

## 重要事項

*   **APIキーについて**:
    *   Gemini APIキーは**ブラウザに自動で保存されません**。セッション中のみ有効です。アプリケーションを再起動した際は、再度「API設定」から入力するか、CSVインポートで設定を読み込む必要があります。
    *   APIキーのテスト機能が提供されています。
    *   Gemini APIの利用には、ご自身のGoogle CloudプロジェクトでAPIキーを発行し、適切なAPIを有効にする必要があります。利用料金はAPIキーを発行したGoogleアカウントに準じます。
*   **データ永続化について**:
    *   チャット履歴 (`currentConversationHistory`) と設定 (`persona`, `summaryPrompt` など) は、ブラウザのローカルストレージには一部保存されますが、主にファイルでの保存・読み込みが推奨されます。
    *   「チャット保存」で作成されるのは個別のMarkdownファイルと、インメモリの履歴リスト (`allChatSummaries`) への追加です。このリスト自体はブラウザを閉じると失われます。
    *   `allChatSummaries`を永続的に保存するには、「各種設定」内の「**全履歴をJSONで保存**」を使用し、JSONファイルをダウンロードしてください。同様に、過去の全履歴を読み込むには「**全履歴をJSONから読込**」を使用します。
    *   各種設定も同様に、「各種設定」内の「**設定をCSVで保存**」/「**設定をCSVから読込**」を利用してバックアップ・復元を行ってください。

## 使い方

### 1. APIキーの設定（初回必須）

1.  アプリケーションを開いたら、ヘッダー右端の「**API設定**」ボタンをクリックします。
2.  モーダルウィンドウに、ご自身で取得したGemini APIキーを入力します。
3.  「**APIキーをテスト**」ボタンをクリックして、APIキーが有効であることを確認します。
4.  「**設定**」ボタンをクリックしてAPIキーを確定します。これでチャットを開始できます。

### 2. AIとのチャット

1.  **メッセージ入力**: 画面下部の大きなテキストエリアにメッセージを入力します。
    *   `Enter`キーでメッセージを送信します。
    *   `Shift + Enter`で改行できます。
2.  **画像添付**:
    *   テキストエリア横のクリップアイコン`📎`をクリックして画像ファイルを選択するか、画像をテキストエリアに直接ペーストします。
    *   添付した画像はプレビューされ、横の`&times;`ボタンで削除できます。
3.  **音声入力**:
    *   マイクアイコン`🎤`をクリックすると音声入力が開始されます（アイコンが🎙️に変わります）。
    *   もう一度クリックすると録音を停止し、テキストエリアに音声がテキストとして入力されます。
4.  **メッセージの操作**:
    *   チャットボックス内のメッセージをクリックすると選択状態になります（ハイライトされます）。
    *   選択後、ヘッダーに表示される以下のボタンで操作できます。
        *   「**選択を削除**」: 選択したメッセージを削除します。
        *   「**選択を編集**」: 選択したメッセージの内容を編集します。
        *   「**選択を再生**」: 選択したメッセージを音声で読み上げます。
        *   「**音声停止**」: 現在再生中の音声を停止します。

### 3. チャットの保存と履歴管理

1.  **チャット保存**:
    *   会話が終了したら、ヘッダーの「**チャット保存**」ボタンをクリックします。
    *   AIがチャット内容を分析し、タイトルと概要を自動生成してMarkdownファイルとしてダウンロードされます。
    *   同時に、このチャットのデータは「履歴一覧」に表示されるリスト（インメモリ）に追加されます。
2.  **履歴一覧**:
    *   ヘッダーの「**履歴一覧**」ボタンをクリックすると、保存されたチャットのリストが表示されます。
    *   **検索**: 上部の検索ボックスにキーワードを入力して履歴を絞り込めます。
    *   **並べ替え**: 「並べ替え」ドロップダウンで日付またはタイトル順に並べ替え、隣のアイコンで昇順/降順を切り替えられます。
    *   **読み込み**: リストからチェックボックスでチャットを選択し、「**選択を読込**」をクリックすると、そのチャット内容がメイン画面に表示されます。
    *   **削除**: 選択したチャットをリストから削除します（ファイル自体は削除されません）。
3.  **新しいチャット**:
    *   ヘッダーの「**新しいチャット**」ボタンをクリックすると、現在のチャット内容がクリアされ、新しい会話を開始できます。**保存していないチャット内容は失われますのでご注意ください。**

### 4. 各種設定

ヘッダーの「**各種設定**」ボタンから、AIの動作やアプリケーションの振る舞いを細かく設定できます。

*   **全チャット履歴のエクスポート/インポート**:
    *   「**全履歴をJSONで保存**」: 現在読み込まれているすべてのチャット履歴をJSONファイルとしてPCに保存します。**これを実行しない限り、履歴リストへの変更は永続化されません。**
    *   「**全履歴をJSONから読込**」: 以前保存したJSONファイルを読み込み、現在の履歴リストにマージまたは上書きします。
*   **AIの性格（システムプロンプト）**:
    *   AIに特定の役割や話し方を指示するプロンプトを入力します。例もいくつか提供されています。
*   **チャット概要生成プロンプト**:
    *   「チャット保存」時にAIが要約を生成する際の指示をカスタマイズできます。`{CONVERSATION_HISTORY}`を会話履歴に置き換えて使用されます。
*   **会話履歴の名前設定**:
    *   チャットで表示される「あなた」と「AI」の名前を変更できます。
*   **サウンド設定**:
    *   AI応答時の通知音のオン/オフ、サウンドの種類（サイン波、矩形波など）を設定できます。
*   **AI応答を音声で読み上げる (TTS) 設定**:
    *   AI応答の音声読み上げのオン/オフを設定できます。
    *   「音声の種類」で利用可能な音声を選択します。
    *   「速度」、「ピッチ」、「音量」のスライダーで読み上げの特性を調整します。
*   **設定のファイル保存/読込**:
    *   「**設定をCSVで保存**」: 現在の各種設定をCSVファイルとしてPCに保存します。
    *   「**設定をCSVから読込**」: 以前保存したCSVファイルを読み込み、各種設定を復元します。

### 5. PDFプレビュー

*   ヘッダーの「**PDFプレビュー**」ボタンをクリックすると、現在表示中のチャット（「チャット保存」または「履歴一覧」から読み込まれたチャット）の内容がPDF形式でプレビュー表示されます。
*   プレビュー画面下部の「**PDFをダウンロード**」ボタンから、適切なファイル名でPDFファイルをダウンロードできます。

## 技術スタック

*   HTML
*   CSS
*   JavaScript
*   Google Gemini API
*   `html2pdf.js` (PDF生成ライブラリ)
*   Web Speech API (音声認識・音声合成)

## ライセンス

このプロジェクトはオープンソースではありません。無断での複製、再配布、商用利用はご遠慮ください。

---